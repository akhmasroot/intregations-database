// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model UserIntegration {
  id            String    @id @default(cuid())
  userId        String    
  provider      String    // 'supabase' | 'convex'
  
  // Supabase fields
  supabaseUrl        String?  // encrypted
  supabaseAnonKey    String?  // encrypted  
  supabaseServiceKey String?  // encrypted (optional, for admin operations)
  supabaseProjectRef String?
  
  // Convex fields
  convexAccessToken   String?  // encrypted (from OAuth)
  convexRefreshToken  String?  // encrypted
  convexDeploymentUrl String?
  convexProjectId     String?
  
  // Turso fields
  tursoUrl       String?  // encrypted (libsql URL e.g. libsql://xxx.turso.io)
  tursoAuthToken String?  // encrypted (Turso auth token)
  tursoDatabaseName String?
  
  // PlanetScale fields
  planetscaleHost     String?  // encrypted (e.g. aws.connect.psdb.cloud)
  planetscaleUsername String?  // encrypted
  planetscalePassword String?  // encrypted
  planetscaleDatabaseName String?
  
  // Neon fields
  neonConnectionString String?  // encrypted (postgresql://user:pass@host/db?sslmode=require)
  neonProjectId        String?
  neonDatabaseName     String?
  
  connectedAt   DateTime  @default(now())
  lastUsedAt    DateTime?
  isActive      Boolean   @default(true)
  
  @@unique([userId, provider])
  @@index([userId])
}

model UserIntegrationLog {
  id            String    @id @default(cuid())
  userId        String
  provider      String
  action        String    // 'connect', 'disconnect', 'query', 'insert', 'update', 'delete', 'create_table'
  tableName     String?
  status        String    // 'success' | 'error'
  errorMessage  String?
  metadata      String?   // JSON string for additional info
  createdAt     DateTime  @default(now())
  
  @@index([userId])
  @@index([userId, provider])
}
